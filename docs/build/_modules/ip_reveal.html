

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  
  <title>ip_reveal &mdash; IP Reveal 1.0.1 documentation</title>
  

  
  <link href="../_static/css/theme.css" rel="stylesheet" type="text/css" />
  <link href="../_static/pygments.css" rel="stylesheet" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js" type="text/javascript"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script src="../_static/js/theme.js" type="text/javascript"></script>

    
    <link href="../genindex.html" rel="index" title="Index" />
    <link href="../search.html" rel="search" title="Search" />
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav class="wy-nav-side" data-toggle="wy-nav-shift">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a class="icon icon-home" href="../index.html"> IP Reveal
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
    <input name="q" placeholder="Search docs" type="text" />
    <input name="check_keywords" type="hidden" value="yes" />
    <input name="area" type="hidden" value="default" />
  </form>
</div>

          
        </div>

        
        <div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">

      
      <nav aria-label="top navigation" class="wy-nav-top">
        
          <i class="fa fa-bars" data-toggle="wy-nav-top"></i>
          <a href="../index.html">IP Reveal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div aria-label="breadcrumbs navigation" role="navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a class="icon icon-home" href="../index.html"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>ip_reveal</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
           <div itemprop="articleBody">
            
  <h1>Source code for ip_reveal</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">node</span>
<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">gaierror</span>
<span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">URLError</span>

<span class="kn">import</span> <span class="nn">PySimpleGUIQt</span> <span class="k">as</span> <span class="nn">Qt</span>
<span class="kn">from</span> <span class="nn">inspy_logger</span> <span class="kn">import</span> <span class="n">getLogger</span><span class="p">,</span> <span class="n">InspyLogger</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span> <span class="nn">requests.exceptions</span> <span class="kn">import</span> <span class="ne">ConnectionError</span>
<span class="kn">from</span> <span class="nn">urllib3.exceptions</span> <span class="kn">import</span> <span class="n">MaxRetryError</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>

<span class="kn">from</span> <span class="nn">ip_reveal.assets.ui_elements.backgrounds</span> <span class="kn">import</span> <span class="n">NEON_DARK_FP</span>

<span class="kn">from</span> <span class="nn">ip_reveal.assets.ui_elements.icons</span> <span class="kn">import</span> <span class="n">app_main_24x24</span><span class="p">,</span> \
                                               <span class="n">app_quit_50x50_fp</span><span class="p">,</span> \
                                               <span class="n">app_refresh_50x50_fp</span>

<span class="kn">from</span> <span class="nn">ip_reveal.tools.arguments</span> <span class="kn">import</span> <span class="n">Reader</span>

<span class="kn">import</span> <span class="nn">ip_reveal.timers</span> <span class="k">as</span> <span class="nn">timer</span>
<span class="kn">from</span> <span class="nn">ip_reveal.popups</span> <span class="kn">import</span> <span class="n">ip_change_notify</span>
<span class="kn">from</span> <span class="nn">ip_reveal.tools</span> <span class="kn">import</span> <span class="n">commify</span>

<span class="n">quit_icon</span> <span class="o">=</span> <span class="n">app_quit_50x50_fp</span>
<span class="n">refresh_icon</span> <span class="o">=</span> <span class="n">app_refresh_50x50_fp</span>

<span class="n">update_window_timer</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">timer</span> <span class="o">=</span> <span class="n">timer</span>
<span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">ip_hist</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">inet_down</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Set up a name for our logging device</span>
<span class="n">log_name</span> <span class="o">=</span> <span class="s2">&quot;IPReveal&quot;</span>

<span class="n">GH_URL</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/Inspyre-Softworks/ip-reveal&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The URL to the Github repo page</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Declare a variable named &#39;acc&#39; for our accumulator and set it at int(0)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># For statistics tracking; declare a variable called &#39;refresh_num&#39; and start it at 0</span>
<span class="n">refresh_num</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># ...and one that will hold our total cycle count</span>
<span class="n">total_acc</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Set up a placeholder variable for our window object</span>
<span class="n">window</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Set up two variables that will act as caches for the external and internal IPs</span>
<span class="n">cached_ext_ip</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">cached_int_ip</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">t_text</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">refreshing</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Set up a global variable to keep track of mute status</span>
<span class="n">mute</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Set up a global variable to keep track of if offline or not</span>
<span class="n">offline</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="get_hostname"><a class="viewcode-back" href="../index.html#ip_reveal.get_hostname">[docs]</a><span class="k">def</span> <span class="nf">get_hostname</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get_hostname</span>

<span class="sd">    Fetch the system&#39;s apparent hostname and return it to the caller</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The system&#39;s apparent hostname contained within a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Prepare the logger</span>
    <span class="n">_log</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="n">log_name</span> <span class="o">+</span> <span class="s1">&#39;.get_hostname&#39;</span><span class="p">)</span>
    <span class="n">_debug</span> <span class="o">=</span> <span class="n">_log</span><span class="o">.</span><span class="n">debug</span>

    <span class="c1"># Fetch the hostname from platform.node</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="n">node</span><span class="p">()</span>
    <span class="n">_debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Checked hostname and found it is: </span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Return this to the caller</span>
    <span class="k">return</span> <span class="n">hostname</span></div>


<div class="viewcode-block" id="get_external"><a class="viewcode-back" href="../index.html#ip_reveal.get_external">[docs]</a><span class="k">def</span> <span class="nf">get_external</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get_external</span>

<span class="sd">    Fetch the system&#39;s apparent hostname and return it to the caller in the form of a string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The system&#39;s apparent external IP-Address in the form of a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cached_ext_ip</span><span class="p">,</span> <span class="n">inet_down</span><span class="p">,</span> <span class="n">ip_hist</span><span class="p">,</span> <span class="n">mute</span>

    <span class="c1"># Prepare the logger</span>
    <span class="n">_log</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="n">log_name</span> <span class="o">+</span> <span class="s1">&#39;.get_external&#39;</span><span class="p">)</span>
    <span class="n">_debug</span> <span class="o">=</span> <span class="n">_log</span><span class="o">.</span><span class="n">debug</span>

    <span class="c1"># Try contacting IPIFY.org with a basic request and read the returned text.</span>
    <span class="c1">#</span>
    <span class="c1"># If we are unable to connect to this outside service, it&#39;s likely that Internet connection has dropped. There are - however, instances where this service is down,</span>
    <span class="c1"># and for these reasons we want to have at least one alternative to control for failure on a Singular -free- AI API.</span>

    <span class="c1"># Fetch the external IP-Address from IPIFY.org</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">external</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.ipify.org&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">_debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Checked external IP and found it is: </span><span class="si">{</span><span class="n">external</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Catch the &quot;ConnectionError&quot; exception that is raised when the &quot;requests&quot; package is unable to reach</span>
    <span class="c1"># &quot;IPIFY.org&quot;, simply reporting this occurred (if the logger is listening) before (maybe first; attempt connection</span>
    <span class="c1"># to another service?)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ConnectionError</span><span class="p">,</span> <span class="n">MaxRetryError</span><span class="p">,</span> <span class="n">gaierror</span><span class="p">,</span> <span class="n">URLError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inet_down</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unable to establish an internet connection.&quot;</span><span class="p">)</span>
            <span class="n">inet_down</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">external</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">external</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_ext_ip</span><span class="p">:</span>
            <span class="n">cached_ext_ip</span> <span class="o">=</span> <span class="n">external</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_ext_ip</span> <span class="o">==</span> <span class="n">external</span><span class="p">:</span>
                <span class="n">ip_change_notify</span><span class="p">(</span><span class="n">cached_ext_ip</span><span class="p">,</span> <span class="n">external</span><span class="p">,</span> <span class="n">mute</span><span class="p">)</span>
                <span class="n">cached_ext_ip</span> <span class="o">=</span> <span class="n">external</span>
                <span class="n">ip_hist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">external</span><span class="p">)</span>


    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ip_hist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;Added first IP to history list.&quot;</span><span class="p">)</span>
        <span class="n">ip_hist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">external</span><span class="p">)</span>
        <span class="n">_debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP History: </span><span class="si">{</span><span class="n">ip_hist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Return the text result we get from the API to the caller.</span>
    <span class="k">return</span> <span class="n">external</span></div>


<div class="viewcode-block" id="get_internal"><a class="viewcode-back" href="../index.html#ip_reveal.get_internal">[docs]</a><span class="k">def</span> <span class="nf">get_internal</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get_internal</span>

<span class="sd">    Fetch the system&#39;s local IP-Address and return it to the caller in the form of a string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The system&#39;s local IP-Address contained within a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set up a logger</span>
    <span class="n">_log</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="n">log_name</span> <span class="o">+</span> <span class="s1">&#39;.get_internal&#39;</span><span class="p">)</span>

    <span class="c1"># Alias the debug entry call</span>
    <span class="n">_debug</span> <span class="o">=</span> <span class="n">_log</span><span class="o">.</span><span class="n">debug</span>

    <span class="c1"># Start a socket</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>

    <span class="c1"># Attempt a connection to an arbitrary host</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># doesn&#39;t even have to be reachable</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;10.255.255.255&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Fetch our IP from this socket&#39;s metadata</span>
        <span class="n">IP</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Should we raise an exception we won&#39;t bother handling it, we&#39;ll just return the loopback address to the caller.</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">IP</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>

    <span class="c1"># No matter the result, let&#39;s remember to close the socket.</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Announce that we&#39;ve found an IP</span>
    <span class="n">_debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Checked internal IP and found: </span><span class="si">{</span><span class="n">IP</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Return a string containing the result to the caller.</span>
    <span class="k">return</span> <span class="n">IP</span></div>


<div class="viewcode-block" id="update_window"><a class="viewcode-back" href="../index.html#ip_reveal.update_window">[docs]</a><span class="k">def</span> <span class="nf">update_window</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    A function that handles the following processes for updating the IP Reveal window:</span>

<span class="sd">      * Updating all relevant fields</span>
<span class="sd">      * Resetting accumulators</span>
<span class="sd">      * Incrementing refresh stats (if opted in)</span>
<span class="sd">      * Fetching the information for external and internal IP addresses</span>
<span class="sd">      * Calls a refresh on the timer.</span>

<span class="sd">    NOTE:</span>
<span class="sd">        It is not advisable to utilize this function in a loop without limiting how often it&#39;s run. You could end up</span>
<span class="sd">        DoSing yourself or others.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">acc</span><span class="p">,</span> <span class="n">refresh_num</span><span class="p">,</span> <span class="n">timer</span><span class="p">,</span> <span class="n">cached_ext_ip</span><span class="p">,</span> <span class="n">ip_hist</span><span class="p">,</span> <span class="n">mute</span><span class="p">,</span> <span class="n">refreshing</span>

    <span class="c1"># Start the logger for this operation</span>
    <span class="n">_log</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="n">log_name</span> <span class="o">+</span> <span class="s1">&#39;.update_window&#39;</span><span class="p">)</span>

    <span class="c1"># If set to do so; spit out some debug data</span>
    <span class="n">u_debug</span> <span class="o">=</span> <span class="n">_log</span><span class="o">.</span><span class="n">debug</span>
    <span class="n">u_debug</span><span class="p">(</span><span class="s1">&#39;TIMEOUT - Refreshing window...&#39;</span><span class="p">)</span>
    <span class="n">u_debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;acc = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Reset the frame accumulator</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Spit out some more useful info, if allowed.</span>
    <span class="n">u_debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reset acc accumulator new value: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">u_debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Incrementing refresh count...&#39;</span><span class="p">)</span>

    <span class="c1"># For stats purposes only; increment our count of window refreshes.</span>
    <span class="n">refresh_num</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Grab our fresh data for diplaying to the window</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">get_external</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ip</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="s2">&quot;Offline&quot;</span>
        <span class="n">offline</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">local_ip</span> <span class="o">=</span> <span class="n">get_internal</span><span class="p">()</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="n">get_hostname</span><span class="p">()</span>

    <span class="c1"># Call a &#39;refresh()&#39; on our timer object. This will start another cycle to keep track of. This allows the timer</span>
    <span class="c1"># routine to always track the time since last data fetching</span>
    <span class="n">timer</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s2">&quot;Offline&quot;</span><span class="p">:</span>
        <span class="n">t_color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t_color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>

    <span class="c1"># Update the relevant fields with our fresh data</span>
    <span class="n">window</span><span class="p">[</span><span class="s1">&#39;EXTIP_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="n">t_color</span><span class="p">)</span>
    <span class="n">window</span><span class="p">[</span><span class="s1">&#39;INTIP_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">local_ip</span><span class="p">)</span>
    <span class="n">window</span><span class="p">[</span><span class="s1">&#39;HOSTNAME_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
    <span class="n">window</span><span class="p">[</span><span class="s1">&#39;TIME_SINCE_Q_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;Just now...&quot;</span><span class="p">)</span>

    <span class="c1"># Make some notes in the debug log that might be useful</span>
    <span class="n">u_debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Updated window with new values: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">u_debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;This was refresh number </span><span class="si">{</span><span class="n">refresh_num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

    <span class="c1"># if not ip == cached_ext_ip:</span>
    <span class="c1">#     ip_change_notify(cached_ext_ip, ip, mute)</span>
    <span class="c1">#     cached_ext_ip = ip</span>
    <span class="c1">#     ip_hist.append(ip)</span>


<div class="viewcode-block" id="safe_exit"><a class="viewcode-back" href="../ip_reveal.html#ip_reveal.safe_exit">[docs]</a><span class="k">def</span> <span class="nf">safe_exit</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">exit_reason</span><span class="p">):</span>
    <span class="n">tmp_hist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ip_hist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_hist</span><span class="p">:</span>
            <span class="n">tmp_hist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;During operation you switched IP addresses </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ip_hist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> times.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Held IP addresses: </span><span class="si">{</span><span class="n">tmp_hist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exiting safely. Reason: </span><span class="si">{</span><span class="n">exit_reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The IP address was refreshed </span><span class="si">{</span><span class="n">refresh_num</span><span class="si">}</span><span class="s2"> times&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Window underwent </span><span class="si">{</span><span class="n">total_acc</span><span class="si">}</span><span class="s2"> cycles&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">timer</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>

    <span class="n">win</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../ip_reveal.html#ip_reveal.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">total_acc</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">refresh_num</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">mute</span><span class="p">,</span> <span class="n">t_text</span><span class="p">,</span> <span class="n">refreshing</span>

    <span class="c1"># Timer text</span>
    <span class="n">t_text</span> <span class="o">=</span> <span class="s2">&quot;Just now...&quot;</span>

    <span class="c1"># Qt.theme(&#39;DarkBlue3&#39;)</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">()</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parsed</span>
    <span class="n">mute</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">mute_all</span>

    <span class="c1"># Set up the logging device</span>
    <span class="n">log_device</span> <span class="o">=</span> <span class="n">InspyLogger</span><span class="p">()</span><span class="o">.</span><span class="n">LogDevice</span><span class="p">(</span><span class="n">log_name</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">log_level</span><span class="p">)</span>

    <span class="c1"># Start the logging device</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">log_device</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span>

    <span class="c1"># Announce that we did that</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Started my logger!&#39;</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="n">log_name</span> <span class="o">+</span> <span class="s1">&#39;.Main&#39;</span><span class="p">)</span>
    <span class="c1"># Alias the log.debug signature for ease-of-use</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span>
    <span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Program muted: </span><span class="si">{</span><span class="n">mute</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># See if we got one of the subcommands assigned.</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">subcommands</span> <span class="o">==</span> <span class="s1">&#39;get-external&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_external</span><span class="p">())</span>
        <span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">subcommands</span> <span class="o">==</span> <span class="s1">&#39;get-host&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_hostname</span><span class="p">())</span>
        <span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">subcommands</span> <span class="o">==</span> <span class="s1">&#39;get-local&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_internal</span><span class="p">())</span>
        <span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">subcommands</span> <span class="o">==</span> <span class="s1">&#39;get-github&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">GH_URL</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">subcommands</span> <span class="o">==</span> <span class="s1">&#39;get-network-info&#39;</span><span class="p">:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">get_external</span><span class="p">()</span>
        <span class="n">local</span> <span class="o">=</span> <span class="n">get_internal</span><span class="p">()</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="n">get_hostname</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Hostname:    </span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
              <span class="sa">f</span><span class="s2">&quot;External IP: </span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
              <span class="sa">f</span><span class="s2">&quot;Local IP:    </span><span class="si">{</span><span class="n">local</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">()</span>

    <span class="n">bg_color</span> <span class="o">=</span> <span class="s2">&quot;340245&quot;</span>
    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">text_background_color</span> <span class="o">=</span> <span class="s2">&quot;pink&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">text_background_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>

    <span class="n">main_menu</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;Application&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="s2">&quot;Preferences&quot;</span><span class="p">]]</span>
    <span class="p">]</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">Qt</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">main_menu</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;#D3D1D3&quot;</span><span class="p">)],</span>
        <span class="p">[</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;External IP:&#39;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_GROOVE</span><span class="p">,</span>
                    <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">get_external</span><span class="p">(),</span> <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_SUNKEN</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;EXTIP_OUT&#39;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span>
                    <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
        <span class="p">],</span>

        <span class="p">[</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Internal IP:&#39;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_GROOVE</span><span class="p">,</span>
                    <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">get_internal</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;INTIP_OUT&#39;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_SUNKEN</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span>
                    <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Hostname:&#39;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_GROOVE</span><span class="p">,</span>
                    <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">get_hostname</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;HOSTNAME_OUT&#39;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_SUNKEN</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span>
                    <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last checked&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_GROOVE</span><span class="p">,</span> <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">t_text</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;TIME_SINCE_Q_OUT&quot;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_SUNKEN</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span>
                    <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_GROOVE</span><span class="p">,</span> <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">t_text</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;STATUS_OUT&quot;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">RELIEF_SUNKEN</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">text_background_color</span><span class="p">,</span>
                    <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">size_px</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;MAIN_CLOSE_BUTTON&#39;</span><span class="p">,</span>
                      <span class="n">image_filename</span><span class="o">=</span><span class="n">app_quit_50x50_fp</span><span class="p">,</span>
                      <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                      <span class="n">button_color</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;#ff0000&quot;</span><span class="p">),</span>
                      <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Quit IP Reveal&quot;</span><span class="p">),</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;MAIN_REFRESH_BUTTON&#39;</span><span class="p">,</span>
                      <span class="n">image_filename</span><span class="o">=</span><span class="n">app_refresh_50x50_fp</span><span class="p">,</span>
                      <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                      <span class="n">button_color</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;#ff0000&quot;</span><span class="p">),</span>
                      <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Refresh&quot;</span><span class="p">)</span>
        <span class="p">],</span>

    <span class="p">]</span>

    <span class="c1"># Assemble the above widget into a window.</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="s1">&#39;IP-Reveal by Inspyre Softworks&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
                       <span class="n">background_image</span><span class="o">=</span><span class="n">NEON_DARK_FP</span><span class="p">,</span>
                       <span class="n">icon</span><span class="o">=</span><span class="n">app_main_24x24</span><span class="p">,</span>
                       <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
                       <span class="n">alpha_channel</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span>
                       <span class="n">grab_anywhere</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                       <span class="n">no_titlebar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">return_keyboard_events</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">keep_on_top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ToDO:</span>
    <span class="c1">#     * Add a config window and associated config file.</span>
    <span class="c1">#         * Include in config window the ability to make the window &quot;Always on top&quot;</span>

    <span class="n">mute</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">mute_all</span>
    <span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Muted: </span><span class="si">{</span><span class="n">mute</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Start our main GUI loop.</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">event</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Set up a child logger that will log window events.</span>
        <span class="n">w_log</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="n">log_name</span> <span class="o">+</span> <span class="s1">&#39;.MainWindow&#39;</span><span class="p">)</span>
        <span class="n">w_debug</span> <span class="o">=</span> <span class="n">w_log</span><span class="o">.</span><span class="n">debug</span>

        <span class="c1"># Increment the cycle count</span>
        <span class="n">acc</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">total_acc</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">t_text</span> <span class="o">=</span> <span class="n">timer</span><span class="o">.</span><span class="n">get_elapsed</span><span class="p">()</span>

        <span class="n">window</span><span class="p">[</span><span class="s1">&#39;TIME_SINCE_Q_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">timer</span><span class="o">.</span><span class="n">get_elapsed</span><span class="p">())</span>

        <span class="n">ref_acc</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">refreshing</span><span class="p">:</span>
            <span class="n">ref_acc</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ref_acc</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">ref_acc</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">dots</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">*</span> <span class="n">ref_acc</span>

            <span class="n">window</span><span class="p">[</span><span class="s1">&#39;STATUS_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refreshing</span><span class="si">{</span><span class="n">dots</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">offline</span><span class="p">:</span>
                <span class="n">window</span><span class="p">[</span><span class="s1">&#39;STATUS_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;Online&quot;</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">window</span><span class="p">[</span><span class="s1">&#39;STATUS_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;Offline&quot;</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

        <span class="c1"># If the accumulator is at 325 counts, alert the user, version the window, and reset the accumulator</span>
        <span class="k">if</span> <span class="n">acc</span> <span class="o">==</span> <span class="mi">325</span><span class="p">:</span>
            <span class="n">w_debug</span><span class="p">(</span><span class="s1">&#39;Calling function to version the window...&#39;</span><span class="p">)</span>
            <span class="n">refreshing</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">window</span><span class="p">[</span><span class="s1">&#39;TIME_SINCE_Q_OUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">&#39;Refreshing...&#39;</span><span class="p">)</span>
            <span class="n">update_win</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">update_window</span><span class="p">)</span>

            <span class="n">update_win</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">w_debug</span><span class="p">(</span><span class="s1">&#39;Updated window!&#39;</span><span class="p">)</span>
            <span class="n">refreshing</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If the &#39;Close&#39; button is pressed: we exit.</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;MAIN_CLOSE_BUTTON&#39;</span><span class="p">:</span>
            <span class="n">e_reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;It seems the user closed the window, received </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;MAIN_CLOSE_BUTTON&#39;</span><span class="p">:</span>
                <span class="n">e_reason</span> <span class="o">=</span> <span class="s1">&#39;The close button was pressed&#39;</span>
            <span class="n">safe_exit</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">exit_reason</span><span class="o">=</span><span class="n">e_reason</span><span class="p">)</span>

            <span class="n">w_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User initiated closing&quot;</span><span class="p">)</span>

            <span class="k">break</span>

        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;MAIN_REFRESH_BUTTON&#39;</span><span class="p">:</span>
            <span class="n">w_debug</span><span class="p">(</span><span class="s1">&#39;Calling a refresh on the window&#39;</span><span class="p">)</span>
            <span class="n">update_window</span><span class="p">()</span>
            <span class="n">w_debug</span><span class="p">(</span><span class="s1">&#39;All seems well!&#39;</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Taylor-Jayde J. Blackstone.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>